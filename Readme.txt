TermoDisplay4x7 - устройство для измерения температуры дома и на улице.
Состоит из 2х программ. Первая - для терминального устройства, вторая - для узлового.
Параметр cMode определяет тип устройства. Терминальное - MODE_TERMINAL, узловое - MODE_NODE.
Параметр DISPLAY_TIME_MS определяет интервал между опросами терминалом узла.

Терминальное устройство имеет 2 LED-экранчика (4-Digit 7-segment LED Display) со сдвиговыми регистрами 74hc595 - по 2 на каждый экранчик, радиомодуль RFM22B-868, настроенный на выходную мощность 8дБм, и термодатчик DS18B20. 
Узловое устройство имеет ту же периферию, кроме экранчиков.

Терминал считывает температуру со своего датчика и посылает по радиоканалу запрос "GetTemp" на узловое устройство. Если узловое устройство включено и словило запрос, оно опрашивает свой датчик и отправляет 2хбайтовый пакет с температурой умноженной на 10 в формате INT16. Терминал отображает на 2х последовательно подключенных экранчиках: на первом - температуру с узла, на втором - свою температуру. Опрос датчика происходит примерно за 1с. Если через 2 секунды от узла не поступило ответа, считаем, что узла нет на линии и пишем "Err" на первом экранчике, тем самым сигнализируя, что узла нет на линии.

Описание экранчика - http://learn.parallax.com/4-digit-7-segment-led-display-arduino-demo.
Сдвиговый регистр - http://www.nxp.com/documents/data_sheet/74HC_HCT595.pdf. 

Печатная плата для устройства подготавливалась и разводилась в программе Altium Designer 16, печать выполнена в Китае - itead.cc. Проект находится в папке "ThermoDisplay_pcb_rev1.2" Фотографии рабочего устройства и платы представлены в репозитории.
Программа написана с использованием среды разработки IAR for STM8 1.40.1. Микроконтроллер - STM8S105C6T6. Остальные компоненты приведены в документе "TermoDisplay_компоненты.xlsx"
Также имеется вспомогательная программа "ThermoDesktop_v1" для отображения значений температуры на компьютере.

v1.03. Алгоритм реализован, нестабильная работа с термодатчиком из-за изменения времени ожидания в one-wire и библиотеки Delay.с. Разработан RTC на 3м таймере, delay реализован на 4м таймере. При счете времени 1мкс выключаются прерывания. 
Недоработки: неразбериха с Delay_us() и RTC

v1.05. Стабильный опрос датчика - ошибка при опросе выскакивает довольно редко. 
Недоработки: гаснет экран при опросе датчика и узла, значение с узла может прыгать в пределах +/- 3 градуса, надо брать среднее по выборке, чтобы это избежать.

v1.06. Стабильная. Экран больше не гаснет при опросе узла и термодатчика (небольшое двойное мерцание есть при опросе датчика). В RTC крутится функция отображения температур на экране. На узле после каждого опроса в течение 50 секунд берется 12 значений температуры, из выборки выкидывается наибольшее и наименьшее и считается среднее арифметическое по оставшимся 10ти. Терминал раз в 60 секунд опрашивает узел и отображает значение со своего датчика и это среднее с узла. Перед каждым опросом загорается на 100 мс светодиод на терминале. После каждой выдачи информации на узле моргает светодиод.
Недоработки: если терминал перезапустится через 10 секунд после опроса и спросит у узла значение температуры, узел ничего не отдаст, надо ждать еще 40 секунд - можно исправить, выдавая последнее сохраненное значение. Исправить в версии 1.07

v1.07. Теперь узел немедленно отдаёт по запросу своё последнее значение температуры, а пока не опрашивают, раз в 3.5 секунды снимает очередное показание с термодатчика. Если таких показаний набралось 12, вычисляет среднее значение с отрбрасыванием минимального/максимального. Терминал 3 раза шлёт запрос с ожиданием в 1 секунду и только после этого детектирует, что узла нет на линии. Т.О. ускоряется процесс съёма данных с узла. Значение на узле обновляется примерно раз в 50 секунд. Значение на терминале обновляется в соответствии с параметром TEMP_REFRESH_TIME_MS, которое по умолчанию равно 60 секунд. Исправлено вычисление средней температуры на узле.

Т.к. улица является более агрессивной средой, более склонной к флуктуациям температуры, чем дом, было решено оставить вычисление среднего значения на улице, а дома вычислять лишь текущее в момент опроса. Это позволит избежать частых мограний Экранчика (во время опроса температуры терминалом, экран моргает 2 раза).

v1.08. В процессе тестирования на стабильность. Добавлен wachdog на узел и терминал. Исправлена отправка повторных сообщений по РФ с терминала. При старте экран терминала показывает сообщение: Start. Получение пакета по РФ вынесено в rtc. По получении пакета, он сразу же считывается, выставляется флаг, что пакет принят. Флаг сбрасывается из main().

v1.09 Выставлены настройки - на Узле - каждое из 12ти измерений температуры происходит с интервалом 3 секунды. Терминал шлет запрос на узел, обновляет своё значение температуры и обновляет значение на экране раз в 20 секунд. В пакет-запрос от терминала добавлена его температура. Теперь можно вводить в сеть третье устройство - прослушивающее линию. Это устройство впоследствии может принимать сообщение-запрос с температурой терминала, сообщение-ответ с температурой узла и по UART/USB/RS-232 отправлять на компьютер. Мощность передатчика - 8дБм (6.3мВт).

v1.10. Добавлена возможность выбора между частотами 434 и 868 с помощью define в библиотеке rfm22.c. Исправлен баг с ситуацией, когда на старте, при отсутствии узла, на экране терминала высвечивался белый шум. Функция отправки на терминале перенесена ближе к отлавливанию ответа в main, тем самым повышая вероятность принять пакет с первого раза. Но, к сожалению, если запрос был отправлен, пока узел измеряет температуру, ответ может не быть получен с первого раза.